(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{728:function(a,s,n){"use strict";n.r(s);var e=n(45),v=Object(e.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"npm-精准控制依赖版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm-精准控制依赖版本"}},[a._v("#")]),a._v(" "),n("Label",{attrs:{level:1}}),a._v("NPM 精准控制依赖版本")],1),a._v(" "),n("p",[a._v("NPM v5 引入了 "),n("code",[a._v("package-lock.json")]),a._v("，将其作为捕获在任意时刻安装的确切依赖树的机制，确保不同成员不同环境都能够获得完全相同的依赖树。")]),a._v(" "),n("h2",{attrs:{id:"npm-shrinkwrap-json"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm-shrinkwrap-json"}},[a._v("#")]),a._v(" npm-shrinkwrap.json")]),a._v(" "),n("ul",[n("li",[a._v("每次更新 "),n("code",[a._v("package.json")]),a._v(" 或者 "),n("code",[a._v("node_modules")]),a._v(" 时，如 "),n("code",[a._v("npm install")]),a._v(" 新包，"),n("code",[a._v("npm update")]),a._v("， "),n("code",[a._v("npm uninstall")]),a._v(" 等操作，为保持协作人的资源一致，还是要手动运行 "),n("code",[a._v("npm shrinkwrap")]),a._v(" 更新 "),n("code",[a._v("npm-shrinkwrap.json")]),a._v(" 文件的。")]),a._v(" "),n("li",[a._v("shrinkwrap 计算时是根据当前依赖安装的目录结构生成的，如果你不能保证 "),n("code",[a._v("package.json")]),a._v(" 文件定义的依赖与 "),n("code",[a._v("node_modules")]),a._v(" 下已安装的依赖是匹配、无冗余的，建议在执行 shrinkwrap 命令前清理依赖并重新安装（"),n("code",[a._v("rm -rf node_modules && npm install")]),a._v("）或精简依赖（"),n("code",[a._v("npm prune")]),a._v("）。")])]),a._v(" "),n("h2",{attrs:{id:"package-lock-json"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#package-lock-json"}},[a._v("#")]),a._v(" package-lock.json")]),a._v(" "),n("h3",{attrs:{id:"package-json-映射-package-lock-json"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#package-json-映射-package-lock-json"}},[a._v("#")]),a._v(" package.json 映射 package-lock.json")]),a._v(" "),n("ul",[n("li",[n("p",[a._v("npm5 后，在项目里会存在一个文件——package-lock.json")])]),a._v(" "),n("li",[n("p",[a._v("要确保你不去直接更改 "),n("code",[a._v("package-lock.json")]),a._v("。这将由 NPM 自动处理，它将对 "),n("code",[a._v("package.json")]),a._v(" 的更改反映到"),n("code",[a._v("package-lock.json")]),a._v("，并保持最新。")])]),a._v(" "),n("li",[n("p",[a._v("但是只有在使用 NPM 的 CLI 进行更改时，才会发生这种情况。如果你手动更改 "),n("code",[a._v("package.json")]),a._v("，则不要期望 "),n("code",[a._v("package-lock.json")]),a._v("会更新。要始终使用 CLI 命令，例如 "),n("code",[a._v("install，uninstall")]),a._v("等。")])])]),a._v(" "),n("h3",{attrs:{id:"使用-npm-cli-时的依赖变化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-npm-cli-时的依赖变化"}},[a._v("#")]),a._v(" 使用 NPM CLI 时的依赖变化")]),a._v(" "),n("h4",{attrs:{id:"npm-install-uninstall（使用特定模块作为参数）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm-install-uninstall（使用特定模块作为参数）"}},[a._v("#")]),a._v(" npm install/uninstall（使用特定模块作为参数）")]),a._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[a._v("npm install express body"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("parser cors\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("p",[a._v("这将更改 "),n("code",[a._v("package.json")]),a._v(" 和 "),n("code",[a._v("package-lock.json")]),a._v("，因为依赖关系树将会发生变化。")]),a._v(" "),n("h4",{attrs:{id:"npm-install（不带参数）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm-install（不带参数）"}},[a._v("#")]),a._v(" npm install（不带参数）")]),a._v(" "),n("ul",[n("li",[n("code",[a._v("install")]),a._v(" 将尝试安装与 "),n("code",[a._v("package-lock.json")]),a._v(" 相关的所有依赖项。")]),a._v(" "),n("li",[a._v("如果有人手动更改 "),n("code",[a._v("package.json")]),a._v("（例如，删除了一个软件包），那么下次有人运行 "),n("code",[a._v("npm install")]),a._v(" 时，它将更改 "),n("code",[a._v("package-lock.json")]),a._v(" 以反映对先前软件包的删除。")])]),a._v(" "),n("h4",{attrs:{id:"npm-update"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm-update"}},[a._v("#")]),a._v(" npm update")]),a._v(" "),n("p",[n("code",[a._v("update")]),a._v(" 将会读取 "),n("code",[a._v("package.json")]),a._v("，用来查找可以更新的所有依赖项。随后它将构造一个新的依赖关系树并更新 "),n("code",[a._v("package-lock.json")])]),a._v(" "),n("h4",{attrs:{id:"npm-ci"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm-ci"}},[a._v("#")]),a._v(" npm ci")]),a._v(" "),n("p",[n("code",[a._v("ci")]),a._v(" 将安装与 "),n("code",[a._v("package-lock.json")]),a._v(" 有关的所有依赖项，类似于 "),n("code",[a._v("install")]),a._v(" 这里的主要区别在于，在任何情况下都不会更改 "),n("code",[a._v("package-lock.json")])]),a._v(" "),n("h3",{attrs:{id:"结论"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[a._v("#")]),a._v(" 结论")]),a._v(" "),n("ul",[n("li",[a._v("用 NPM CLI 更改依赖项，如"),n("code",[a._v("npm install/uninstall")])]),a._v(" "),n("li",[a._v("不要在没有参数的情况下使用 "),n("code",[a._v("npm install")]),a._v(" 来获取依赖关系，请使用 "),n("code",[a._v("npm ci")])]),a._v(" "),n("li",[a._v("如果所有成员都可以使用 NPM+5，则最好对未发布的项目使用 "),n("code",[a._v("package-lock.json")])]),a._v(" "),n("li",[a._v("可以将"),n("code",[a._v("package-lock.json")]),a._v("提交至代码库，跟踪或检出确切的依赖树")])]),a._v(" "),n("h2",{attrs:{id:"npm-shrinkwrap-json-与-package-lock-json-的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm-shrinkwrap-json-与-package-lock-json-的区别"}},[a._v("#")]),a._v(" npm-shrinkwrap.json 与 package-lock.json 的区别")]),a._v(" "),n("h3",{attrs:{id:"从-npm-版本看"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从-npm-版本看"}},[a._v("#")]),a._v(" 从 npm 版本看")]),a._v(" "),n("ul",[n("li",[n("code",[a._v("package-lock.json")]),a._v(" 是 npm5 的新特性，也不向前兼容，如果 npm 版本是 4 或以下，那还是使用 "),n("code",[a._v("npm-shrinkwrap.json")]),a._v(" 吧")])]),a._v(" "),n("h3",{attrs:{id:"从-npm-处理机制来看"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从-npm-处理机制来看"}},[a._v("#")]),a._v(" 从 npm 处理机制来看")]),a._v(" "),n("ul",[n("li",[n("p",[a._v("如果项目里不存在这两个文件，那么在运行 "),n("code",[a._v("npm cli")]),a._v(" 时，会自动生成 "),n("code",[a._v("package-lock.json")]),a._v("，安装信息会依据该文件进行，而不是单纯按照 "),n("code",[a._v("package.json")]),a._v("，这两个文件的优先级都比 "),n("code",[a._v("package.json")]),a._v(" 高")])]),a._v(" "),n("li",[n("p",[a._v("如果项目两个文件都存在，那么安装的依赖是依据 "),n("code",[a._v("npm-shrinkwrap.json")]),a._v(" 来的，而忽略 "),n("code",[a._v("package-lock.json")])])]),a._v(" "),n("li",[n("p",[a._v("运行命令 "),n("code",[a._v("npm shrinkwrap")]),a._v(" 后，如果项目里不存在 "),n("code",[a._v("package-lock.json")]),a._v("，那么会新建一个 "),n("code",[a._v("npm-shrinkwrap.json")]),a._v(" 文件，如果存在 "),n("code",[a._v("package-lock.json")]),a._v("，那么会把 "),n("code",[a._v("package-lock.json")]),a._v(" 重命名为 "),n("code",[a._v("npm-shrinkwrap.json")])])])]),a._v(" "),n("h3",{attrs:{id:"从文件更新来看"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从文件更新来看"}},[a._v("#")]),a._v(" 从文件更新来看")]),a._v(" "),n("ul",[n("li",[n("code",[a._v("npm-shrinkwrap.json")]),a._v(" 只会在运行 "),n("code",[a._v("npm shrinkwrap")]),a._v(" 才会创建/更新")]),a._v(" "),n("li",[n("code",[a._v("package-lock.json")]),a._v(" 会在修改 "),n("code",[a._v("pacakge.json")]),a._v(" 时自动产生或更新了。")])]),a._v(" "),n("h3",{attrs:{id:"从发布包来看"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从发布包来看"}},[a._v("#")]),a._v(" 从发布包来看")]),a._v(" "),n("ul",[n("li",[n("code",[a._v("package-lock.json")]),a._v(" 不会在发布包中出现，就算出现了，也会遭到 "),n("code",[a._v("npm")]),a._v(" 的无视。")]),a._v(" "),n("li",[n("code",[a._v("npm-shrinkwrap.json")]),a._v(" 可以在发布包中出现")])]),a._v(" "),n("h2",{attrs:{id:"npm-info-查看所依赖的各个版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm-info-查看所依赖的各个版本"}},[a._v("#")]),a._v(" npm info 查看所依赖的各个版本")]),a._v(" "),n("h3",{attrs:{id:"eslint-config-airbnb"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#eslint-config-airbnb"}},[a._v("#")]),a._v(" eslint-config-airbnb")]),a._v(" "),n("p",[a._v("Airbnb 标准,它依赖 eslint, eslint-plugin-import, eslint-plugin-react, and eslint-plugin-jsx-a11y 等插件，并且对各个插件的版本有所要求。")]),a._v(" "),n("p",[a._v("你可以执行以下命令查看所依赖的各个版本：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("npm info \"eslint-config-airbnb@latest\" peerDependencies\n\n// 你会看到以下输出信息，包含每个了每个plugins的版本要求\n{ eslint: '^3.15.0',\n  'eslint-plugin-jsx-a11y': '^3.0.2 || ^4.0.0',\n  'eslint-plugin-import': '^2.2.0',\n  'eslint-plugin-react': '^6.9.0' }\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br")])])])}),[],!1,null,null,null);s.default=v.exports}}]);