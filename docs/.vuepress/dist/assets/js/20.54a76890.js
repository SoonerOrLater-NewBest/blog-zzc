(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{441:function(t,s,a){t.exports=a.p+"assets/img/image2.0f17ff8d.png"},563:function(t,s,a){t.exports=a.p+"assets/img/image.ebc32989.png"},564:function(t,s,a){t.exports=a.p+"assets/img/image1.68f231f9.png"},662:function(t,s,a){"use strict";a.r(s);var e=a(45),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"mac-本地部署-ai-绘图-stable-diffusion-webui（intel-版）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mac-本地部署-ai-绘图-stable-diffusion-webui（intel-版）"}},[t._v("#")]),t._v(" "),e("Label",{attrs:{level:1}}),t._v("Mac 本地部署#AI 绘图 stable-diffusion-webui（Intel 版）")],1),t._v(" "),e("blockquote",[e("p",[t._v("其实 2024 年了，教怎么部署的文章已经很多了，但我实操一下，还是很多坑，因此记录一下\n这篇文章"),e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/637067918",target:"_blank",rel:"noopener noreferrer"}},[t._v("手把手教你在 Mac 上部署 stable-diffusion，晋级高阶 AI 绘图及模型训练"),e("OutboundLink")],1),t._v("讲的很详细，但实际跑不起来，因此着重描述下部署问题")])]),t._v(" "),e("h2",{attrs:{id:"系统配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#系统配置"}},[t._v("#")]),t._v(" 系统配置")]),t._v(" "),e("p",[t._v("Stable Diffusion WebUI 当然支持 Windows/Linux，也适配三种芯片")]),t._v(" "),e("ul",[e("li",[t._v("NVidia (recommended)")]),t._v(" "),e("li",[t._v("AMD GPUs、Intel CPUs,")]),t._v(" "),e("li",[t._v("Intel GPUs (both integrated and discrete)")])]),t._v(" "),e("p",[e("strong",[t._v("我的配置如下：")])]),t._v(" "),e("ul",[e("li",[t._v("系统：MacOS（14.3.1 我最新更新的，应该关系不大）")]),t._v(" "),e("li",[t._v("Python：3.10.6（就装这个版本，因为 stable-diffusion-webui 是用这个构建的，其他版本不一定行）")]),t._v(" "),e("li",[t._v("显卡：Intel Iris Plus Graphics 645 1536 MB（这个坑挺大的）")])]),t._v(" "),e("p",[e("strong",[t._v("注意以下部署就是按照 mac 的英特尔显卡，不同配置有所不同")])]),t._v(" "),e("h2",{attrs:{id:"直奔主题，开始部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#直奔主题，开始部署"}},[t._v("#")]),t._v(" 直奔主题，开始部署")]),t._v(" "),e("h3",{attrs:{id:"_1、安装-homebrew（便捷安装-mac-软件的插件）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装-homebrew（便捷安装-mac-软件的插件）"}},[t._v("#")]),t._v(" 1、安装 Homebrew（便捷安装 Mac 软件的插件）")]),t._v(" "),e("p",[t._v("依次打开“启动台-其他-终端，在“终端”中输入："),e("code",[t._v('/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"')]),t._v(" 输入密码（密码不会显示），按回车，然后继续按提示“回车”，等待自动安装完成")]),t._v(" "),e("h3",{attrs:{id:"_2、-安装-python3-10-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、-安装-python3-10-6"}},[t._v("#")]),t._v(" 2、 安装 python3.10.6")]),t._v(" "),e("p",[t._v("终端输入"),e("code",[t._v("brew install cmake protobuf rust python@3.10.6 git wget")]),t._v("这里面装了很多，可能还会要求你更新 xcode，反正按提示安装，终端输入"),e("code",[t._v("xcode-select --install")])]),t._v(" "),e("h3",{attrs:{id:"_3、-克隆安装-webui-软件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、-克隆安装-webui-软件"}},[t._v("#")]),t._v(" 3、 克隆安装 webui 软件")]),t._v(" "),e("ul",[e("li",[t._v("根据"),e("a",{attrs:{href:"https://github.com/openvinotoolkit/stable-diffusion-webui/wiki/Installation-on-Intel-Silicon",target:"_blank",rel:"noopener noreferrer"}},[t._v("Installation on Intel Silicon"),e("OutboundLink")],1),t._v("，我们选择在“终端”中输入："),e("code",[t._v("git clone https://github.com/openvinotoolkit/stable-diffusion-webui.git")]),t._v("，然后回车等待自动安装完成，这里就用到了上面安装的 git，如果实在用不来，也可以直接去 github 网站上，download 这个项目的压缩包直接解压即可"),e("img",{attrs:{src:a(563),alt:"download"}})])]),t._v(" "),e("ul",[e("li",[t._v("虽然"),e("code",[t._v("AUTOMATIC1111")]),t._v("才是主仓库且已经更新到 1.8 版本，但是我看最新版没有了"),e("code",[t._v("OpenVINO")]),t._v("这个自定义脚本，所以我们就选择了"),e("code",[t._v("openvinotoolkit")]),t._v("，这个仓库还是 1.6 版本")]),t._v(" "),e("li",[t._v("接着安装项目运行所需依赖")])]),t._v(" "),e("div",{staticClass:"language-cmd line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("cd stable-diffusion-webui\n./webui.sh\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("ul",[e("li",[t._v("上面代码将自动安装依赖，这时候会遇到很多报错，首先解决网络问题，能科学上网的自不必说，也可以将 python 源换为国内镜像")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("cd ~\nmkdir .pip\n\ncd .pip\ntouch pip.conf\n\n在pip.conf文件中，添加以下内容：\n\n[global]\nindex-url = https://pypi.doubanio.com/simple/\ntrusted-host = pypi.doubanio.com\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br")])]),e("ul",[e("li",[t._v("或直接在源码里加也是可以的，如下图，找到"),e("code",[t._v("stable-diffusion-webui/modules/launch_utils.py")]),t._v('第 138 行，增加"-i https://mirrors.aliyun.com/pypi/simple/"\n'),e("img",{attrs:{src:a(564),alt:"pip"}})])]),t._v(" "),e("ul",[e("li",[t._v("安装会遇到各种问题，详见下一章，安装完成后，还要下载模型然后导入（直接放进对应文件夹，可以参考最上面的文章）")])]),t._v(" "),e("h3",{attrs:{id:"_4、常见问题处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、常见问题处理"}},[t._v("#")]),t._v(" 4、常见问题处理")]),t._v(" "),e("h4",{attrs:{id:"_4-1-缺少-openai-模块等"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-缺少-openai-模块等"}},[t._v("#")]),t._v(" 4.1 缺少 openai 模块等")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("OSError"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Can"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'t load tokenizer for '")]),t._v("openai"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("clip"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("vit"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("large"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("patch14"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'. If you were trying to load it from '")]),t._v("https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("huggingface"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("co"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("models"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("', make sure you don'")]),t._v("t have a local directory "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" the same name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Otherwise"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" make sure "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'openai/clip-vit-large-patch14'")]),t._v(" is the correct path to a directory containing all relevant files "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" a CLIPTokenizer tokenizer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 遇到如上报错，需要安装'openai/clip-vit-large-patch14'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在stable-diffusion-webui项目下，创建openai文件夹")]),t._v("\nmkdir openai\ngit clone https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("huggingface"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("co"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("openai"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("clip"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("vit"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("large"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("patch14\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("h4",{attrs:{id:"_4-2-modulenotfounderror-no-module-named-lzma"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-modulenotfounderror-no-module-named-lzma"}},[t._v("#")]),t._v(" 4.2 "),e("code",[t._v("ModuleNotFoundError: No module named '_lzma'")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("brew install xz\npip install backports.lzma\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("h4",{attrs:{id:"_4-3-oserror-we-couldn-t-connect-to-https-huggingface-co"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-oserror-we-couldn-t-connect-to-https-huggingface-co"}},[t._v("#")]),t._v(" 4.3 "),e("code",[t._v("OSError: We couldn't connect to 'https://huggingface.co' .......")])]),t._v(" "),e("ul",[e("li",[t._v("这主要是因为连不上"),e("code",[t._v("https://huggingface.co")]),t._v("，启动时很多地方会去请求这个网站，下载模型也会去请求这个网站，有时候即使科学上网也不好使")]),t._v(" "),e("li",[t._v("于是我们还是切换源,在终端输入下面 3 句，第一句是切换镜像源，下 2 句是英特尔 CPU+GPU 的场景执行前环境要生效的内容")])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HF_ENDPOINT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("hf"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mirror"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PYTORCH_TRACING_MODE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TORCHFX")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COMMANDLINE_ARGS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--skip-torch-cuda-test --precision full --no-half"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("h2",{attrs:{id:"启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("./webui.sh --precision full --no-half")])]),t._v(" "),e("li",[t._v("即使切换了源可以下载，也建议自行下载好模型后放入文件夹，因为模型都比较大")]),t._v(" "),e("li",[t._v("然后 lora 模型，插件配置等，还是建议参考"),e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/637067918",target:"_blank",rel:"noopener noreferrer"}},[t._v("手把手教你在 Mac 上部署 stable-diffusion，晋级高阶 AI 绘图及模型训练"),e("OutboundLink")],1)])]),t._v(" "),e("p",[e("img",{attrs:{src:a(441),alt:"ui"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);